// Pnp Potion of Invulnerability

COPY "%MOD_FOLDER%/spells/potn11.spl" "override"
  

COPY_EXISTING "potn11.itm" "override"
  SAY IDENTIFIED_DESC @0

  LAUNCH_PATCH_FUNCTION ITEM_EFFECT_TO_SPELL
    STR_VAR
    new_itm_spl			= "potn11.spl"
  END

  LAUNCH_PATCH_FUNCTION DELETE_ITEM_EFFECT
    INT_VAR
    opcode_to_delete		= "-1"
  END

  LAUNCH_PATCH_FUNCTION ADD_ITEM_EFFECT
    INT_VAR
    opcode			= 146	// Spell: Cast Spell (at Creature)
    target			= 1	// Self
    timing			= 1	// Permanent
    parameter2			= 1	// Cast Instantly
    STR_VAR
    resource			= "potn11"
  END


COPY_EXISTING "potn11.spl" "override/potn11.spl"
  LAUNCH_PATCH_FUNCTION ALTER_ITEM_EFFECT
    INT_VAR
    duration_high		= 60
  END

  PATCH_FOR_EACH match_opcode IN 0 33 34 35 36 37
  BEGIN
    LAUNCH_PATCH_FUNCTION ALTER_EFFECT
      INT_VAR
      match_opcode
      parameter1		= 2
      parameter2		= 0
    END
  END

  LAUNCH_PATCH_FUNCTION CLONE_EFFECT
    INT_VAR
    match_opcode		= 0	// AC vs. Damage Type Modifier
    opcode			= 120	// Protection: from Melee Weapons
    parameter1			= 0
    parameter2			= 2	// Non-Magical
    STR_VAR
    insert			= "below"
  END

  LAUNCH_PATCH_FUNCTION CLONE_EFFECT
    INT_VAR
    match_opcode		= 142	// Graphics: Display SFX Icon
    parameter2			= 70	// Protection from Normal Weapons
    STR_VAR
    insert			= "below"
  END

  LAUNCH_PATCH_FUNCTION mh_prevent_spell_effect_stacking END


